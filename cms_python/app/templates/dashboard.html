{% extends "base.html" %}

{% block sidebar %}
<!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
<aside class="sidebar">
    <div class="quick-actions">
        <h3>ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
        <button class="quick-btn" onclick="quickAction('new-faq')">
            <span class="icon">ğŸ“</span>
            æ–°è¦FAQä½œæˆ
        </button>
        <button class="quick-btn" onclick="quickAction('upload-audio')">
            <span class="icon">ğŸ¤</span>
            éŸ³å£°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        </button>
        <button class="quick-btn" onclick="quickAction('schedule-meeting')">
            <span class="icon">ğŸ“…</span>
            é¢è«‡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
        </button>
        <button class="quick-btn" onclick="quickAction('generate-report')">
            <span class="icon">ğŸ“Š</span>
            ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
        </button>
    </div>

    <div class="notification-center">
        <h3>ğŸ”” é€šçŸ¥ã‚»ãƒ³ã‚¿ãƒ¼</h3>
        <div class="notification-item urgent">
            <span class="notification-icon">ğŸš¨</span>
            <div class="notification-content">
                <div class="notification-title">ç·Šæ€¥å¯¾å¿œå¿…è¦</div>
                <div class="notification-desc">å¤§å‹æ©Ÿé–¢æŠ•è³‡å®¶ã‹ã‚‰ã®é‡è¦è³ªå•</div>
                <div class="notification-time">5åˆ†å‰</div>
            </div>
        </div>
        <div class="notification-item">
            <span class="notification-icon">âœ…</span>
            <div class="notification-content">
                <div class="notification-title">FAQæ‰¿èªå®Œäº†</div>
                <div class="notification-desc">ã€ŒQ1æ¥­ç¸¾ã«ã¤ã„ã¦ã€ãŒå…¬é–‹ã•ã‚Œã¾ã—ãŸ</div>
                <div class="notification-time">1æ™‚é–“å‰</div>
            </div>
        </div>
    </div>
</aside>
{% endblock %}

{% block content %}
<!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<div class="dashboard-content">
    <!-- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ -->
    <div class="health-check">
        <h2>ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯</h2>
        <div class="health-grid">
            {% for key, item in health_status.items() %}
            <div class="health-item">
                <div class="health-icon">
                    {% if key == 'ai_system' %}ğŸ¤–
                    {% elif key == 'api_connection' %}ğŸ“¡
                    {% elif key == 'security' %}ğŸ”’
                    {% elif key == 'database' %}ğŸ’¾
                    {% endif %}
                </div>
                <div class="health-info">
                    <div class="health-label">
                        {% if key == 'ai_system' %}AI ã‚·ã‚¹ãƒ†ãƒ 
                        {% elif key == 'api_connection' %}APIé€£æº
                        {% elif key == 'security' %}ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
                        {% elif key == 'database' %}ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
                        {% endif %}
                    </div>
                    <div class="health-status {{ item.status }}">
                        {% if item.status == 'online' %}ç¨¼åƒä¸­
                        {% elif item.status == 'warning' %}æ³¨æ„
                        {% endif %}
                    </div>
                    <div class="health-detail">
                        {% if key == 'ai_system' %}ç²¾åº¦: {{ item.accuracy }}
                        {% elif key == 'api_connection' %}ãƒ¬ã‚¹ãƒãƒ³ã‚¹: {{ item.response_time }}
                        {% elif key == 'security' %}è„…å¨: {{ item.threats }}
                        {% elif key == 'database' %}å®¹é‡: {{ item.capacity }}
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯æ¦‚è¦ -->
    <div class="today-tasks">
        <h2>ğŸ“‹ ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯æ¦‚è¦</h2>
        <div class="task-summary">
            {% for task in task_summary %}
            <div class="task-card">
                <div class="task-number">{{ task.number }}</div>
                <div class="task-label">{{ task.label }}</div>
                <div class="task-action">
                    <button class="btn-primary" onclick="navigateTo('{{ task.action }}')">
                        {% if task.action == 'dialogue' %}å¯¾å¿œã™ã‚‹
                        {% elif task.action == 'ai-faq' %}ç¢ºèªã™ã‚‹
                        {% elif task.action == 'meetings' %}æº–å‚™ã™ã‚‹
                        {% elif task.action == 'data-input' %}ç¢ºèªã™ã‚‹
                        {% endif %}
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- KPIã‚µãƒãƒªãƒ¼ -->
    <div class="kpi-summary">
        <h2>ğŸ“ˆ KPIã‚µãƒãƒªãƒ¼ï¼ˆä»Šé€±ï¼‰</h2>
        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-icon">ğŸ‘¥</div>
                <div class="kpi-content">
                    <div class="kpi-value">{{ kpi_data.engagement.value }}</div>
                    <div class="kpi-label">æŠ•è³‡å®¶ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆ</div>
                    <div class="kpi-change {{ 'positive' if kpi_data.engagement.positive else 'negative' }}">
                        {{ kpi_data.engagement.change }}
                    </div>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon">ğŸ¯</div>
                <div class="kpi-content">
                    <div class="kpi-value">{{ kpi_data.satisfaction.value }}</div>
                    <div class="kpi-label">FAQæº€è¶³åº¦</div>
                    <div class="kpi-change {{ 'positive' if kpi_data.satisfaction.positive else 'negative' }}">
                        {{ kpi_data.satisfaction.change }}
                    </div>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon">â±ï¸</div>
                <div class="kpi-content">
                    <div class="kpi-value">{{ kpi_data.response_time.value }}</div>
                    <div class="kpi-label">å¹³å‡å›ç­”æ™‚é–“</div>
                    <div class="kpi-change {{ 'positive' if kpi_data.response_time.positive else 'negative' }}">
                        {{ kpi_data.response_time.change }}
                    </div>
                </div>
            </div>
            <div class="kpi-card">
                <div class="kpi-icon">ğŸ¤</div>
                <div class="kpi-content">
                    <div class="kpi-value">{{ kpi_data.voice_processing.value }}</div>
                    <div class="kpi-label">éŸ³å£°è³ªå•å‡¦ç†</div>
                    <div class="kpi-change {{ 'positive' if kpi_data.voice_processing.positive else 'negative' }}">
                        {{ kpi_data.voice_processing.change }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Insights -->
    <div class="ai-insights">
        <h2>ğŸ”® AI Insights</h2>
        <div class="insights-grid">
            <div class="insight-card trend">
                <div class="insight-icon">ğŸ“Š</div>
                <div class="insight-content">
                    <h3>ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ</h3>
                    <p>ã€ŒESGæˆ¦ç•¥ã€ã«é–¢ã™ã‚‹è³ªå•ãŒéå»30æ—¥é–“ã§<strong>+45%</strong>å¢—åŠ ã—ã¦ã„ã¾ã™ã€‚é–¢é€£FAQ ã®å……å®Ÿã‚’æ¨å¥¨ã—ã¾ã™ã€‚</p>
                    <button class="insight-action" onclick="createESGFAQ()">ESG FAQä½œæˆ</button>
                </div>
            </div>
            <div class="insight-card alert">
                <div class="insight-icon">âš ï¸</div>
                <div class="insight-content">
                    <h3>æ³¨æ„å–šèµ·</h3>
                    <p>ã€Œåç›Šæ€§æ”¹å–„ã€ã«ã¤ã„ã¦<strong>ãƒã‚¬ãƒ†ã‚£ãƒ–ã‚»ãƒ³ãƒãƒ¡ãƒ³ãƒˆ</strong>ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚èª¬æ˜è³‡æ–™ã®è¦‹ç›´ã—ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚</p>
                    <button class="insight-action" onclick="reviewContent()">å†…å®¹ç¢ºèª</button>
                </div>
            </div>
            <div class="insight-card opportunity">
                <div class="insight-icon">ğŸ’¡</div>
                <div class="insight-content">
                    <h3>æ”¹å–„ææ¡ˆ</h3>
                    <p>éŸ³å£°è³ªå•ã®å‡¦ç†æ™‚é–“ã‚’<strong>23%çŸ­ç¸®</strong>ã§ãã‚‹AIæœ€é©åŒ–æ¡ˆãŒã‚ã‚Šã¾ã™ã€‚å®Ÿè£…ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚</p>
                    <button class="insight-action" onclick="optimizeAI()">æœ€é©åŒ–å®Ÿè¡Œ</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰å›ºæœ‰ã®JavaScript
async function quickAction(action) {
    console.log(`ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ${action}`);
    
    try {
        switch(action) {
            case 'new-faq':
                window.location.href = '/ai-faq';
                break;
            case 'upload-audio':
                window.location.href = '/data-input';
                break;
            case 'schedule-meeting':
                KAGAMI.notify.toast('é¢è«‡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ©Ÿèƒ½ã¯é–‹ç™ºä¸­ã§ã™', 'info');
                break;
            case 'generate-report':
                const response = await fetch('/api/analytics/kpi');
                const data = await response.json();
                KAGAMI.notify.toast('ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'success');
                break;
        }
    } catch (error) {
        KAGAMI.notify.toast('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
        console.error('ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
    }
}

async function createESGFAQ() {
    try {
        const response = await fetch('/api/ai-faq/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ topic: 'ESGæˆ¦ç•¥' })
        });
        const data = await response.json();
        KAGAMI.notify.toast('ESG FAQç”Ÿæˆã‚’é–‹å§‹ã—ã¾ã—ãŸ', 'success');
    } catch (error) {
        KAGAMI.notify.toast('FAQç”Ÿæˆã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 'error');
    }
}

// ãƒšãƒ¼ã‚¸å›ºæœ‰ã®åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', function() {
    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‡ãƒ¼ã‚¿æ›´æ–°
    setInterval(async () => {
        try {
            const response = await fetch('/api/dashboard/data');
            const data = await response.json();
            // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æ›´æ–°å‡¦ç†
        } catch (error) {
            console.error('ãƒ‡ãƒ¼ã‚¿æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        }
    }, 30000); // 30ç§’é–“éš”
});
</script>
{% endblock %} 